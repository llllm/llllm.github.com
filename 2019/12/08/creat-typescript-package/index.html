<!DOCTYPE html>
<html>
  <!-- Html Head Tag-->
  <head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content>
  <meta name="author" content="五更黑喵">
  <!-- Open Graph Data -->
  <meta property="og:title" content="使用typescript开发Npm包">
  <meta property="og:description" content="一只萌新前端">
  <meta property="og:site_name" content="五更黑喵">
  <meta property="og:type" content="article">
  <meta property="og:image" content="http://llllm.github.io">
  
    <link rel="alternate" href="/atom.xml" title="五更黑喵" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  

  <!-- Site Title -->
  <title>五更黑喵</title>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <!-- Custom CSS -->
  
  <link rel="stylesheet" href="/css/style.light.css">

  <!-- Google Analytics -->
  

</head>

  <body>
    <!-- Page Header -->


<header class="site-header header-background" style="background-image: url(/img/default-banner-dark.jpg)">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="page-title with-background-image">
          <p class="title">使用typescript开发Npm包</p>
          <p class="subtitle"></p>
        </div>
        <div class="site-menu with-background-image">
          <ul>
            
              <li>
                <a href="/">
                  
                  Home
                  
                </a>
              </li>
            
              <li>
                <a href="/archives">
                  
                  Archives
                  
                </a>
              </li>
            
              <li>
                <a href="https://github.com/llllm">
                  
                  Github
                  
                </a>
              </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>

<article>
  <div class="container typo">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-info text-muted">
          
            <!-- Author -->
            <span class="author info">By 五更黑喵</span>
          
          <!-- Date -->
          <span class="date-time info">On
            <span class="date">2019-12-08</span>
            <span class="time">23:30:57</span>
          </span>
          
          <!--  Categories  -->
            <span class="categories info">Under 

<a href="/categories/typescript/">typescript</a>
</span>
          
        </div>
        <!-- Tags -->
        
          <div class="post-tags text-muted">
            Tags: 

<a class="tag" href="/tags/npm/">#npm</a> <a class="tag" href="/tags/typescript/">#typescript</a> <a class="tag" href="/tags/nodejs/">#nodejs</a>


          </div>
        
        <!-- creat toc -->
        <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#配置typescript环境"><span class="post-toc-text">配置typescript环境</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#安装依赖包"><span class="post-toc-text">安装依赖包</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#typescript配置"><span class="post-toc-text">typescript配置</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#tslint-配置"><span class="post-toc-text">tslint 配置</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#配置测试环境"><span class="post-toc-text">配置测试环境</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#安装依赖包-1"><span class="post-toc-text">安装依赖包</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#配置mocha"><span class="post-toc-text">配置mocha</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#配置vscode调试环境"><span class="post-toc-text">配置vscode调试环境</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#typescript-调试环境"><span class="post-toc-text">typescript 调试环境</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#mocha调试环境"><span class="post-toc-text">mocha调试环境</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#示例"><span class="post-toc-text">示例</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#目录结构"><span class="post-toc-text">目录结构</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#代码示例"><span class="post-toc-text">代码示例</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#安装使用"><span class="post-toc-text">安装使用</span></a></li></ol></li></ol>
        <!-- Post Main Content -->
        <div class="post-content">
          <p>使用typescript开发npm包实际上和直接使用typescript开发程序相差不大，同样需要搭建一个完整的typescript环境，只是需要注意上传打包后的文件<br><a id="more"></a></p>
<h1 id="配置typescript环境"><a href="#配置typescript环境" class="headerlink" title="配置typescript环境"></a>配置typescript环境</h1><h2 id="安装依赖包"><a href="#安装依赖包" class="headerlink" title="安装依赖包"></a>安装依赖包</h2><p>初始化项目并安装typescript包,tslint做代码检查并非必要，配置tslint可以使用tslint-config-standard，也可以自行参考tslint文档配置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br><span class="line">npm i --save-dev typescript</span><br><span class="line">npm i --save-dev tslint</span><br><span class="line">npm i --save-dev tslint-config-standard</span><br></pre></td></tr></table></figure></p>
<h2 id="typescript配置"><a href="#typescript配置" class="headerlink" title="typescript配置"></a>typescript配置</h2><p>tsc依赖于全局安装的typescript,建议使用tsc生成配置在修改自己需要的配置项<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tsc --init</span><br></pre></td></tr></table></figure></p>
<p>如果不想全局安装typescript，当然也可以直接新建tsconfig.json文件添加配置<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"compilerOptions"</span>: &#123;</span><br><span class="line">    <span class="attr">"target"</span>: <span class="string">"es5"</span>,</span><br><span class="line">    <span class="attr">"module"</span>: <span class="string">"commonjs"</span>,</span><br><span class="line">    <span class="attr">"declaration"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"declarationMap"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"sourceMap"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"outDir"</span>: <span class="string">"./dist"</span>,</span><br><span class="line">    <span class="attr">"strict"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"baseUrl"</span>: <span class="string">"./"</span>,</span><br><span class="line">    <span class="attr">"paths"</span>: &#123;</span><br><span class="line">      <span class="attr">"@/*"</span>: [<span class="string">"src/*"</span>]</span><br><span class="line">    &#125;,     </span><br><span class="line">    <span class="attr">"esModuleInterop"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"experimentalDecorators"</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="attr">"emitDecoratorMetadata"</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">   <span class="attr">"include"</span>: [</span><br><span class="line">    <span class="string">"src/*"</span>,</span><br><span class="line">    <span class="string">"types/*"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"exclude"</span>: [</span><br><span class="line">    <span class="string">"test/*.spec.ts"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>以上配置中除默认配置外需要注意开启declaration生成.d.ts文件,其他配置项可以更具需要添加，需要注意排除测试文件</p>
<h2 id="tslint-配置"><a href="#tslint-配置" class="headerlink" title="tslint 配置"></a>tslint 配置</h2><p>使用tslint-config-standard的话如下配置即可<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"extends"</span>: <span class="string">"tslint-config-standard"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="配置测试环境"><a href="#配置测试环境" class="headerlink" title="配置测试环境"></a>配置测试环境</h1><h2 id="安装依赖包-1"><a href="#安装依赖包-1" class="headerlink" title="安装依赖包"></a>安装依赖包</h2><p>这里使用的测试库是mocha，使用的断言库是chai<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev mocha</span><br><span class="line">npm install --save-dev @types/mocha</span><br><span class="line">npm install --save-dev chai</span><br><span class="line">npm install --save-dev @types/chai</span><br><span class="line">npm install --save-dev ts-node</span><br><span class="line">npm install --save-dev cross-env</span><br></pre></td></tr></table></figure></p>
<h2 id="配置mocha"><a href="#配置mocha" class="headerlink" title="配置mocha"></a>配置mocha</h2><p>在package.json中添加一条测试命令,在mocha中注册ts-mode执行对应的test文件夹下的测试脚本<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">    "test": "cross-env TS_NODE_FILES=true mocha -r ts-node/register test/*.test.ts"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>需要注意在ts-node7.0以上版本中，可能会出现找不到本地声明的.d.ts文件，这个时候只需要在环境变量中添加TS_NODE_FILES=true就可以了，而cross-env是跨平台环境变量设置用的包建议使用</p>
<h1 id="配置vscode调试环境"><a href="#配置vscode调试环境" class="headerlink" title="配置vscode调试环境"></a>配置vscode调试环境</h1><h2 id="typescript-调试环境"><a href="#typescript-调试环境" class="headerlink" title="typescript 调试环境"></a>typescript 调试环境</h2><p>typescript在不使用ts-node的情况下也可以配置生成map文件来进行调试。而ts-node可以直接运行ts文件，这里是ts-node的调试方式,参考配置如下<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"Current TS File"</span>,</span><br><span class="line">  <span class="attr">"type"</span>: <span class="string">"node"</span>,</span><br><span class="line">  <span class="attr">"request"</span>: <span class="string">"launch"</span>,</span><br><span class="line">  <span class="attr">"args"</span>: [</span><br><span class="line">    <span class="string">"$&#123;workspaceRoot&#125;/src/index.ts"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"runtimeArgs"</span>: [</span><br><span class="line">    <span class="string">"--nolazy"</span>,</span><br><span class="line">    <span class="string">"-r"</span>,</span><br><span class="line">    <span class="string">"ts-node/register"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"sourceMaps"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"cwd"</span>: <span class="string">"$&#123;workspaceRoot&#125;"</span>,</span><br><span class="line">  <span class="attr">"protocol"</span>: <span class="string">"inspector"</span>,</span><br><span class="line">  <span class="attr">"console"</span>: <span class="string">"integratedTerminal"</span>,</span><br><span class="line">  <span class="attr">"internalConsoleOptions"</span>: <span class="string">"neverOpen"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="mocha调试环境"><a href="#mocha调试环境" class="headerlink" title="mocha调试环境"></a>mocha调试环境</h2><p>还是一样的吊样mocha将ts-node注册进去执行测试的ts文件即可，如果ts-node是7.0以上版本不要忘记添加环境变量<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"Debug Current TS Tests File"</span>,</span><br><span class="line">  <span class="attr">"type"</span>: <span class="string">"node"</span>,</span><br><span class="line">  <span class="attr">"request"</span>: <span class="string">"launch"</span>,</span><br><span class="line">  <span class="attr">"env"</span>: &#123;</span><br><span class="line">    <span class="attr">"TS_NODE_FILES"</span>: <span class="string">"true"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"program"</span>: <span class="string">"$&#123;workspaceRoot&#125;/node_modules/.bin/_mocha"</span>,</span><br><span class="line">  <span class="attr">"args"</span>: [</span><br><span class="line">    <span class="string">"-r"</span>,</span><br><span class="line">    <span class="string">"ts-node/register"</span>,</span><br><span class="line">    <span class="string">"$&#123;relativeFile&#125;"</span>,</span><br><span class="line">    <span class="string">"--colors"</span>,</span><br><span class="line">    <span class="string">"-t 100000"</span>,</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"cwd"</span>: <span class="string">"$&#123;workspaceRoot&#125;"</span>,</span><br><span class="line">  <span class="attr">"protocol"</span>: <span class="string">"inspector"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h1><h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">|-- root</span><br><span class="line">    |-- src</span><br><span class="line">    |-- test</span><br><span class="line">    |-- types</span><br><span class="line">    |-- .gitignore</span><br><span class="line">    |-- tsconfig.json</span><br><span class="line">    |-- tslint.json</span><br><span class="line">    |-- package.json</span><br><span class="line">    |-- README.md</span><br></pre></td></tr></table></figure>
<p>需要注意在开发分支忽略生成后的静态文件,建议在发布分支包裹生成的静态文件</p>
<h2 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h2><p>src/index.ts<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">guid</span> (<span class="params">data?: <span class="built_in">Array</span>&lt;<span class="built_in">string</span>&gt;</span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> _data = data || []</span><br><span class="line">  _data.push(</span><br><span class="line">    ([<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>].indexOf(_data.length) &lt; <span class="number">0</span> ? <span class="string">''</span> : <span class="string">'-'</span>) +</span><br><span class="line">      (((<span class="number">1</span> + <span class="built_in">Math</span>.random()) * <span class="number">0x10000</span>) | <span class="number">0</span>).toString(<span class="number">16</span>).substring(<span class="number">1</span>)</span><br><span class="line">  )</span><br><span class="line">  <span class="keyword">return</span> _data.length &gt;= <span class="number">8</span> ? _data.join(<span class="string">''</span>) : guid(_data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>test/index.spec.ts<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; DataBind, guid &#125; <span class="keyword">from</span> <span class="string">'../src/index'</span></span><br><span class="line"><span class="keyword">import</span> &#123; expect &#125; <span class="keyword">from</span> <span class="string">'chai'</span></span><br><span class="line"></span><br><span class="line">describe(<span class="string">'guid function'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  it(<span class="string">'should return string'</span>, <span class="function">(<span class="params">done</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> GUID = guid()</span><br><span class="line">    done()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<h2 id="安装使用"><a href="#安装使用" class="headerlink" title="安装使用"></a>安装使用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save git+https://xxxx</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; guid &#125; = <span class="built_in">require</span>(<span class="string">'toolbox'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(guid())</span><br></pre></td></tr></table></figure>
        </div>
      </div>
    </div>
  </div>
</article>



    <!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <p class="copyright text-muted">
          Theme By <a target="_blank" href="https://github.com/levblanc">Levblanc.</a>
          <!-- Inspired By <a target="_blank" href="https://github.com/klugjo/hexo-theme-clean-blog">Clean Blog.</a> -->
        <p class="copyright text-muted">
          Powered By <a target="_blank" href="https://hexo.io/">Hexo.</a>
        </p>
      </div>
    </div>
  </div>
</footer>


    <!-- After Footer Scripts -->
<script src="/js/highlight.pack.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function(event) {
    var codeBlocks = Array.prototype.slice.call(document.getElementsByTagName('pre'))
    codeBlocks.forEach(function(block, index) {
      hljs.highlightBlock(block);
    });
  });
</script>

  </body>
</html>

